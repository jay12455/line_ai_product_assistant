# ServeOn - æ™ºæ…§å®¢æœèˆ‡åŒ…è£¹è¿½è¹¤ç³»çµ±

## å°ˆæ¡ˆç°¡ä»‹
ServeOn æ˜¯ä¸€å€‹çµåˆ LINE Bot çš„æ™ºæ…§å®¢æœç³»çµ±ï¼Œæ•´åˆäº†åŒ…è£¹è¿½è¹¤ã€å•†å“æ¨è–¦å’Œå®¢æˆ¶æœå‹™åŠŸèƒ½ã€‚ç³»çµ±ä½¿ç”¨äººå·¥æ™ºæ…§æŠ€è¡“é€²è¡Œè‡ªç„¶èªè¨€è™•ç†å’Œæƒ…æ„Ÿåˆ†æï¼Œæä¾›å€‹äººåŒ–çš„æœå‹™é«”é©—ã€‚

## ä¸»è¦åŠŸèƒ½
- ğŸ“¦ åŒ…è£¹è¿½è¹¤ç®¡ç† - å³æ™‚æŸ¥è©¢å’Œé€šçŸ¥åŒ…è£¹ç‹€æ…‹
- ğŸ¤– æ™ºæ…§å®¢æœå°è©± - è‡ªç„¶èªè¨€ç†è§£èˆ‡å›æ‡‰
- ğŸ¯ å€‹äººåŒ–å•†å“æ¨è–¦ - åŸºæ–¼ç”¨æˆ¶è¡Œç‚ºåˆ†æçš„æ¨è–¦
- ğŸ“Š å®¢æˆ¶æƒ…æ„Ÿåˆ†æ - å³æ™‚åˆ†æç”¨æˆ¶æƒ…ç·’èˆ‡æ»¿æ„åº¦
- ğŸ” å‘é‡æœç´¢åŠŸèƒ½ - é«˜æ•ˆç‡ç›¸ä¼¼åº¦æŸ¥è©¢
- ğŸ‘¥ ç¾¤çµ„èŠå¤©é©æ‡‰ - é‡å°ç¾¤çµ„å’Œå€‹äººèŠå¤©çš„å·®ç•°åŒ–è™•ç†
- ğŸ§  å­¸ç¿’èˆ‡è¨˜æ†¶ç³»çµ± - åˆ†åˆ¥å„²å­˜å€‹äººèˆ‡ç¾¤çµ„å°è©±æ­·å²åŠå‘é‡

## æŠ€è¡“æ¶æ§‹
- **å¾Œç«¯æ¡†æ¶**: Flask
- **è³‡æ–™åº«**:
  - MariaDB (é—œè¯å¼è³‡æ–™åº«) - å­˜å„²ç”¨æˆ¶è³‡æ–™èˆ‡äº¤æ˜“è¨˜éŒ„
  - Qdrant (å‘é‡è³‡æ–™åº«) - å­˜å„²æ–‡æœ¬åµŒå…¥å‘é‡
- **AI æ¨¡å‹**:
  - OpenAI API - æ–‡æœ¬åµŒå…¥èˆ‡è‡ªç„¶èªè¨€è™•ç†
  - DistilBERT - å¤šèªè¨€æƒ…æ„Ÿåˆ†æ
- **è¨Šæ¯å¹³å°**: LINE Messaging API

## å®‰è£éœ€æ±‚
- Python 3.8+
- Docker
- MariaDB
- Qdrant å‘é‡è³‡æ–™åº«
- LINE Developer å¸³è™Ÿ
- OpenAI API é‡‘é‘°

## ç’°å¢ƒè¨­å®š
1. å…‹éš†å°ˆæ¡ˆ
```bash
git clone https://github.com/your-username/ServeOn.git
cd ServeOn
```

2. å®‰è£ç›¸ä¾å¥—ä»¶
```bash
pip install -r requirements.txt
```

3. è¨­å®šç’°å¢ƒè®Šæ•¸
```bash
cp .env.example .env
# ç·¨è¼¯ .env æ–‡ä»¶å¡«å…¥å¿…è¦çš„è¨­å®šï¼ŒåŒ…æ‹¬ OpenAI API é‡‘é‘°
```

4. å•Ÿå‹• Qdrant å‘é‡è³‡æ–™åº«
```bash
docker run -d --name qdrant -p 6333:6333 -p 6334:6334 -v ~/qdrant_data:/qdrant/storage qdrant/qdrant
```

5. åˆå§‹åŒ–è³‡æ–™åº«
```bash
python init_db.py
python init_qdrant.py
```

## å•Ÿå‹•æœå‹™
ä½¿ç”¨ Screen ç®¡ç†å¤šå€‹ç¨‹åºï¼š

```bash
# API æœå‹™
screen -S api
python api.py

# LINE Bot æœå‹™
screen -S linebot
python Linebot.py

# Ngrok é€šé“ (é–‹ç™¼ç’°å¢ƒä½¿ç”¨)
screen -S ngrok
ngrok http 5002
```

## ç³»çµ±æ¶æ§‹
```
ServeOn/
â”œâ”€â”€ ai/                    # AI ç›¸é—œæ¨¡çµ„
â”‚   â”œâ”€â”€ assistant.py       # AI åŠ©æ‰‹
â”‚   â”œâ”€â”€ sentiment_analyzer.py  # æƒ…æ„Ÿåˆ†æ
â”‚   â””â”€â”€ ai_recommender.py  # æ¨è–¦ç³»çµ±
â”œâ”€â”€ database/              # è³‡æ–™åº«è™•ç†
â”‚   â”œâ”€â”€ db_handler.py      # è³‡æ–™åº«æ“ä½œ
â”‚   â”œâ”€â”€ init.sql           # è³‡æ–™åº«åˆå§‹åŒ–è…³æœ¬
â”‚   â””â”€â”€ product_info/      # å•†å“è³‡è¨Šè™•ç†
â”œâ”€â”€ templates/             # ç¶²é æ¨¡æ¿
â”‚   â”œâ”€â”€ admin_panel.html   # ç®¡ç†å“¡é¢æ¿
â”‚   â””â”€â”€ product_management.html # å•†å“ç®¡ç†ç•Œé¢
â”œâ”€â”€ api.py                 # REST API æœå‹™
â””â”€â”€ Linebot.py             # LINE Bot ä¸»ç¨‹å¼
```

## è³‡æ–™åº«è¨­è¨ˆ
ç³»çµ±è³‡æ–™åº«è¨­è¨ˆå€åˆ†å€‹äººèˆ‡ç¾¤çµ„èŠå¤©è³‡æ–™ï¼š
- **å€‹äººèŠå¤©è¡¨æ ¼**ï¼š
  - `personal_chat_history` - å„²å­˜å€‹äººå°è©±æ­·å²
  - `personal_chat_embeddings` - å€‹äººå°è©±å‘é‡åµŒå…¥
- **ç¾¤çµ„èŠå¤©è¡¨æ ¼**ï¼š
  - `group_chat_history` - å„²å­˜ç¾¤çµ„å°è©±æ­·å²
  - `group_chat_embeddings` - ç¾¤çµ„å°è©±å‘é‡åµŒå…¥
- **ä¸€èˆ¬è¡¨æ ¼**ï¼š
  - `line_users` - ç”¨æˆ¶è³‡è¨Š
  - `package_tracking` - åŒ…è£¹è¿½è¹¤è³‡è¨Š
  - `product_details` - å•†å“è³‡è¨Š

## API ç«¯é»
- `/api/package/status/<tracking_code>`: æŸ¥è©¢åŒ…è£¹ç‹€æ…‹
- `/api/user/packages/<line_user_id>`: æŸ¥è©¢ç”¨æˆ¶åŒ…è£¹
- `/api/package/status/update`: æ›´æ–°åŒ…è£¹ç‹€æ…‹
- `/api/products/recommend`: ç²å–å•†å“æ¨è–¦
- `/api/sentiment/analyze`: æƒ…æ„Ÿåˆ†ææ¥å£

## æ™ºèƒ½æ¨è–¦ç³»çµ±
ç³»çµ±ä½¿ç”¨ä»¥ä¸‹æ–¹å¼é€²è¡Œå•†å“æ¨è–¦ï¼š
- åŸºæ–¼ç”¨æˆ¶æ­·å²äº’å‹•è¨˜éŒ„
- æƒ…æ„Ÿåˆ†æçµæœå°å‘æ¨è–¦
- å‘é‡ç›¸ä¼¼åº¦æœç´¢åŒ¹é…å•†å“
- æ•´åˆå³æ™‚æ´»å‹•èˆ‡ä¿ƒéŠ·è¨Šæ¯

## æƒ…æ„Ÿåˆ†æç³»çµ±
ç³»çµ±ä½¿ç”¨å¤šå±¤ç´šæƒ…æ„Ÿåˆ†ææ–¹æ³•ï¼š
- åŸºç¤æ¨¡å‹: DistilBERT å¤šèªè¨€æƒ…æ„Ÿåˆ†æ
- å¢å¼·åˆ†æ: OpenAI API é€²è¡Œæ·±åº¦æƒ…æ„Ÿç†è§£
- æä¾›æƒ…æ„Ÿåˆ†æ•¸ã€æ¨™ç±¤åŠå›æ‡‰å»ºè­°
- æ”¯æ´å‘é‡åµŒå…¥å­˜å„²ï¼Œä¾¿æ–¼å¾ŒçºŒåˆ†æ
- å€åˆ†è™•ç†å€‹äººèˆ‡ç¾¤çµ„èŠå¤©çš„æƒ…æ„Ÿåˆ†æ

## éŒ¯èª¤è™•ç†
ç³»çµ±åŒ…å«å®Œæ•´çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼š
- è³‡æ–™åº«é€£æ¥ç•°å¸¸è™•ç†èˆ‡è‡ªå‹•é‡è©¦
- API è«‹æ±‚éŒ¯èª¤èˆ‡è¶…æ™‚è™•ç†
- LINE è¨Šæ¯è™•ç†ç•°å¸¸éš”é›¢
- AI æ¨¡å‹èª¿ç”¨å¤±æ•—å‚™ç”¨æ–¹æ¡ˆ
- å‘é‡æœç´¢ç•°å¸¸è™•ç†èˆ‡é™ç´šæœå‹™

## ç¶­è­·æŒ‡å—
- å®šæœŸæª¢æŸ¥æ—¥èªŒæ–‡ä»¶ï¼Œç‰¹åˆ¥æ˜¯éŒ¯èª¤æ—¥èªŒ
- ç›£æ§è³‡æ–™åº«æ•ˆèƒ½ï¼Œé©æ™‚å„ªåŒ–æŸ¥è©¢
- å®šæœŸæ›´æ–° LINE Bot Webhook ç¶²å€è¨­å®š
- å‚™ä»½é—œè¯å¼è³‡æ–™åº«å’Œå‘é‡è³‡æ–™åº«
- æª¢æŸ¥ AI æ¨¡å‹æ•ˆèƒ½ï¼Œé©æ™‚æ›´æ–°æˆ–å¾®èª¿

## è²¢ç»æŒ‡å—
æ­¡è¿æäº¤ Pull Request æˆ–å»ºç«‹ Issueã€‚

## æˆæ¬Šå”è­°
æœ¬å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Šå”è­°ã€‚

## è¯çµ¡è³‡è¨Š
å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹è¯ç¹«é–‹ç™¼åœ˜éšŠï¼š
- Email: contact@example.com
- GitHub: https://github.com/your-username/ServeOn

## å°ˆæ¡ˆé‚è¼¯æ¡†æ¶

### æ ¸å¿ƒæ¨¡çµ„äº’å‹•
```mermaid
graph TD
    A[LINE Bot] --> B[è¨Šæ¯è™•ç†å™¨]
    B --> C{è¨Šæ¯é¡å‹åˆ¤æ–·}
    C -->|ä¸€èˆ¬å°è©±| D[AI Assistant]
    C -->|åŒ…è£¹æŸ¥è©¢| E[åŒ…è£¹è¿½è¹¤ç³»çµ±]
    C -->|å•†å“ç›¸é—œ| F[å•†å“æ¨è–¦ç³»çµ±]
    D --> G[å‘é‡è³‡æ–™åº«]
    F --> G
    G --> H[MariaDB]
    
    B --> I{èŠå¤©ç’°å¢ƒåˆ¤æ–·}
    I -->|å€‹äººèŠå¤©| J[å€‹äººå°è©±è™•ç†]
    I -->|ç¾¤çµ„èŠå¤©| K[ç¾¤çµ„å°è©±è™•ç†]
    J --> L[å€‹äººå°è©±è³‡æ–™åº«]
    K --> M[ç¾¤çµ„å°è©±è³‡æ–™åº«]
```

### æ•¸æ“šæµå‘
```mermaid
graph LR
    A[ç”¨æˆ¶è¼¸å…¥] --> B[è‡ªç„¶èªè¨€è™•ç†]
    B --> C[å‘é‡åŒ–]
    C --> D[å‘é‡æœç´¢]
    D --> E[çµæœæ•´åˆ]
    E --> F[éŸ¿æ‡‰ç”Ÿæˆ]
    F --> G[ç”¨æˆ¶è¼¸å‡º]
```

## ç³»çµ±é‹è¡Œæµç¨‹

### 1. åˆå§‹åŒ–æµç¨‹
1. è¼‰å…¥ç’°å¢ƒé…ç½®
   - è®€å– .env æª”æ¡ˆä¸­çš„è¨­å®š
   - åˆå§‹åŒ–è³‡æ–™åº«é€£æ¥
   - å»ºç«‹ LINE Bot å®¢æˆ¶ç«¯

2. å•Ÿå‹•æœå‹™
   - åˆå§‹åŒ– Flask æœå‹™å™¨
   - é€£æ¥å‘é‡è³‡æ–™åº«
   - è¼‰å…¥ AI æ¨¡å‹ï¼ˆæƒ…æ„Ÿåˆ†æèˆ‡æ¨è–¦ç³»çµ±ï¼‰

### 2. è¨Šæ¯è™•ç†æµç¨‹
1. æ¥æ”¶ç”¨æˆ¶è¨Šæ¯
   ```
   LINE å¹³å° -> Webhook -> Flask æœå‹™å™¨
   ```

2. è¨Šæ¯ä¾†æºè­˜åˆ¥
   - åˆ¤æ–·æ˜¯å€‹äººèŠå¤©é‚„æ˜¯ç¾¤çµ„èŠå¤©
   - æ ¹æ“šä¾†æºé¸æ“‡å°æ‡‰è™•ç†ç­–ç•¥
   - å–å¾—ç›¸æ‡‰çš„æ­·å²å°è©±è¨˜éŒ„

3. è¨Šæ¯åˆ†æ
   - æ–‡æœ¬é è™•ç†èˆ‡æ¨™æº–åŒ–
   - æ„åœ–è­˜åˆ¥èˆ‡åˆ†é¡
   - å¯¦é«”è­˜åˆ¥èˆ‡æå–
   - æ ¹æ“šèŠå¤©é¡å‹èª¿æ•´åˆ†ææ·±åº¦

4. æ¥­å‹™é‚è¼¯è™•ç†
   - åŒ…è£¹æŸ¥è©¢èˆ‡ç‹€æ…‹æ›´æ–°
   - å•†å“æ¨è–¦èˆ‡è©³æƒ…æŸ¥è©¢
   - é‡å°å€‹äºº/ç¾¤çµ„çš„æƒ…æ„Ÿåˆ†æ
   - ä¸€èˆ¬å°è©±è™•ç†èˆ‡å›è¦†
   - ç¾¤çµ„èŠå¤©ä¸­çš„å¤šç”¨æˆ¶äº’å‹•è™•ç†

5. éŸ¿æ‡‰ç”Ÿæˆ
   - æ ¹æ“šåˆ†æçµæœçµ„ç¹”éŸ¿æ‡‰å…§å®¹
   - é‡å°å€‹äºº/ç¾¤çµ„é¸æ“‡é©åˆçš„å›æ‡‰æ¨¡æ¿
   - åŠ å…¥å€‹äººåŒ–/ç¾¤çµ„åŒ–å…ƒç´ 
   - ç”Ÿæˆæœ€çµ‚å›è¦†ä¸¦ç™¼é€

6. å­¸ç¿’èˆ‡å„²å­˜
   - å°‡å°è©±å…§å®¹å­˜å…¥ç›¸æ‡‰çš„æ­·å²è¨˜éŒ„è¡¨
   - ç‚ºå…§å®¹ç”Ÿæˆå‘é‡åµŒå…¥ä¸¦å„²å­˜
   - æ›´æ–°ç”¨æˆ¶æˆ–ç¾¤çµ„çš„äº’å‹•æ¨¡å¼

### 3. AI æ¨è–¦æµç¨‹
1. ç”¨æˆ¶è¡Œç‚ºåˆ†æ
   - æ”¶é›†äº¤äº’è¨˜éŒ„èˆ‡æŸ¥è©¢æ¨¡å¼
   - åˆ†æè³¼è²·åå¥½èˆ‡ç€è¦½ç¿’æ…£
   - çµåˆæƒ…æ„Ÿåˆ†æçµæœ
   - è¨ˆç®—ç”¨æˆ¶èˆˆè¶£åˆ†æ•¸

2. å•†å“åŒ¹é…æµç¨‹
   - åŸ·è¡Œå‘é‡ç›¸ä¼¼åº¦è¨ˆç®—
   - çµåˆå‚³çµ±éæ¿¾æ¨è–¦
   - æ•´åˆç•¶å‰ä¿ƒéŠ·èˆ‡æ´»å‹•
   - æ‡‰ç”¨æ¥­å‹™è¦å‰‡å„ªåŒ–çµæœ

3. æ¨è–¦çµæœç”Ÿæˆ
   - å°æ¨è–¦é …ç›®é€²è¡Œæ’åº
   - æ‡‰ç”¨å¤šæ¨£æ€§èˆ‡æ–°é®®åº¦è¦å‰‡
   - æ ¼å¼åŒ–è¼¸å‡ºé©åˆ LINE å¹³å°
   - è¿½è¹¤æ¨è–¦æ•ˆæœè©•ä¼°æ”¹é€²

## é–‹ç™¼æŒ‡å—

### æ¨¡çµ„æ“´å±•
- éµå¾ªç¾æœ‰çš„æ¨¡çµ„çµæ§‹èˆ‡è¨­è¨ˆæ¨¡å¼
- å¯¦ç¾å¿…è¦çš„ä»‹é¢ï¼Œç¢ºä¿å…¼å®¹æ€§
- æ›´æ–°ç›¸é—œé…ç½®æ–‡ä»¶
- æ·»åŠ å–®å…ƒæ¸¬è©¦ç¢ºä¿å“è³ª

### è³‡æ–™åº«æ“ä½œ
- ä½¿ç”¨ DatabaseHandler é€²è¡ŒæŸ¥è©¢
- å¯¦æ–½é©ç•¶çš„äº¤æ˜“ç®¡ç†
- è™•ç†ä¸¦ç™¼è¨ªå•è¡çª
- å»ºç«‹å®Œå–„çš„è³‡æ–™å‚™ä»½æ©Ÿåˆ¶

### AI æ¨¡å‹æ›´æ–°
- æº–å‚™é«˜å“è³ªè¨“ç·´æ•¸æ“š
- èª¿æ•´æ¨¡å‹åƒæ•¸æå‡æ•ˆèƒ½
- è©•ä¼°æ¨¡å‹æ•ˆæœèˆ‡é©ç”¨æ€§
- ç¢ºä¿å¹³æ»‘çš„æ¨¡å‹æ›´æ–°éƒ¨ç½²

### ç¾¤çµ„èˆ‡å€‹äººèŠå¤©è™•ç†
- ç¾¤çµ„èŠå¤©éœ€è€ƒæ…®å¤šç”¨æˆ¶äº’å‹•æ¨¡å¼
- å€‹äººèŠå¤©èšç„¦æ–¼æ·±åº¦å€‹äººåŒ–é«”é©—
- é‡å°ä¸åŒç’°å¢ƒèª¿æ•´å›è¦†çš„è©³ç´°ç¨‹åº¦
- å¯¦ç¾ç’°å¢ƒé©æ‡‰çš„å­¸ç¿’æ©Ÿåˆ¶
- ç®¡ç†ä¸åŒç’°å¢ƒçš„è¨˜æ†¶å®¹é‡èˆ‡æ™‚æ•ˆ

## ç›£æ§èˆ‡ç¶­è­·

### ç³»çµ±ç›£æ§
- API éŸ¿æ‡‰æ™‚é–“
- è³‡æ–™åº«æ€§èƒ½
- AI æ¨è–¦æº–ç¢ºç‡
- ç”¨æˆ¶äº’å‹•çµ±è¨ˆ

### æ•…éšœè™•ç†
- ç³»çµ±ç•°å¸¸æª¢æ¸¬
- è‡ªå‹•å‘Šè­¦æ©Ÿåˆ¶
- å‚™ä»½æ¢å¾©æµç¨‹
- å•é¡Œè¿½è¹¤è¨˜éŒ„

```mermaid
graph TD;
    A[ä½¿ç”¨è€…æŸ¥è©¢ (LINE Bot / Web)] -->|ç™¼é€è«‹æ±‚| B[Flask API ä¼ºæœå™¨];
    B -->|æ–‡æœ¬å‘é‡åŒ–| C[OpenAI Embedding API];
    B -->|æƒ…æ„Ÿåˆ†æ| D[DistilBERT NLP æ¨¡å‹];
    C -->|ç”Ÿæˆå‘é‡| E[Qdrant å‘é‡è³‡æ–™åº«];
    D -->|èª¿æ•´æ¨è–¦ç­–ç•¥| F[æ¨è–¦ç³»çµ±æ ¸å¿ƒ];
    E -->|ç›¸ä¼¼åº¦æª¢ç´¢| F;
    F -->|ç²å–å•†å“è³‡è¨Š| G[MariaDB ç”¢å“è³‡æ–™åº«];
    G -->|è¿”å›æ¨è–¦çµæœ| B;
    B -->|é¡¯ç¤ºæ¨è–¦å•†å“| H[ä½¿ç”¨è€…ä»‹é¢ (LINE Bot / Web)];
```
